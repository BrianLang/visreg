<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  

  <title>visreg</title>
  <meta name="description" content="visreg: An R package for the visualization of regression models">
  
  <link rel="stylesheet" href="css/main.css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
  <script type="text/javascript" src="js/mathjax.config.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</head>


  <body>

    <header>
  <div id="site-wrapper">
    <a id="site-title" href="index.html">visreg</a>
    <span class="version"> 2.7.0.1 </span>
    <div id="site-description">
      An R package for the visualization of regression models
    </div>
  </div>
</header>


    <div id="wrapper">
      <div id="sideBar">
  
  <ul> <h3>Basic framework</h3>
    <li><a href="basic.html">Getting started</a></li>
    <li><a href="contrast.html">Conditional vs. contrast plots</a></li>
    <li><a href="trans.html">Transformations</a></li>
    <li><a href="cond.html">Conditioning</a></li>
    <li><a href="options.html">Graphical options</a></li>
    <li><a href="gg.html">Visreg and ggplot2</a></li>
  </ul>

  <ul> <h3>Models with interactions</h3>
    <li><a href="cross.html">Cross-sectional plots</a></li>
    <li><a href="overlay.html">Overlay plots</a></li>
    <li><a href="surface.html">Surface plots</a></li>
  </ul>
  
  <ul> <h3>Special topics</h3>
    <li><a href="glm.html">GLMs</a></li>
    <li><a href="blackbox.html">Forests, SVMs, etc.</a></li>
    <li><a href="mixed.html">Mixed models</a></li>
    <li><a href="multi.html">Multiple outcomes</a></li>
    <li><a href="faq.html">FAQ</a></li>
  </ul>
</div>

      <div id="content">
        <p>As the name implies, <code class="highlighter-rouge">visreg</code> is primarily designed to visualize regression models.  However, it is also compatible with any formula-based model class that supplies a <code class="highlighter-rouge">predict</code> method, which includes models such as random forests and support vector machines.  Such methods are often thought of as ``black boxes’’, but <code class="highlighter-rouge">visreg</code> offers a convenient way to visualize the resulting fit and possibly gain some insight into the model.  Some of these packages do not automatically handle missing data, so we first create a complete-case data set:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">aq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">airquality</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h1 id="random-forests">Random forests</h1>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Solar.R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Wind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Temp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">aq</span><span class="p">)</span><span class="w">
</span><span class="n">visreg</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="s2">"Temp"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Ozone"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="img/blackbox-rf-1.png" alt="plot of chunk rf" /></p>

<h1 id="support-vector-machines">Support vector machines</h1>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">e1071</span><span class="p">)</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svm</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Solar.R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Wind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Temp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">aq</span><span class="p">)</span><span class="w">
</span><span class="n">visreg</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="s2">"Temp"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Ozone"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="img/blackbox-svm-1.png" alt="plot of chunk svm" /></p>

<p>Note that neither random forests nor support vector machines are able to provide confidence bands for fitted values, so no shaded bands appear.</p>

<h1 id="gradient-boosted-trees">Gradient boosted trees</h1>

<p>The implementation of gradient boosted trees in the <code class="highlighter-rouge">gbm</code> package does not offer a <code class="highlighter-rouge">residuals</code> method.  This would normally cause <code class="highlighter-rouge">visreg</code> to omit plotting the partial residuals.  However, we can supply our own user-defined <code class="highlighter-rouge">residuals</code> method:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">residuals.gbm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">fit</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">fit</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This is useful to be aware of in general: if you are ever working with a model class that does not provide a <code class="highlighter-rouge">residuals</code> method or a <code class="highlighter-rouge">predict</code> method, you can always write your own.</p>

<p>Once defined, we</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">gbm</span><span class="p">)</span><span class="w">
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gbm</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Solar.R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Wind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Temp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">aq</span><span class="p">,</span><span class="w"> </span><span class="n">distribution</span><span class="o">=</span><span class="s2">"gaussian"</span><span class="p">)</span><span class="w">
</span><span class="n">visreg</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="s2">"Temp"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Ozone"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="img/blackbox-gbm_bad-1.png" alt="plot of chunk gbm_bad" /></p>

<p>Note that the default settings for <code class="highlighter-rouge">gbm</code> do not produce a very good fit here.  In particular, the default number of trees (100) is too low to capture the relationship between temperature and ozone.  By increasing the number of trees, we obtain a much more reasonable fit:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gbm</span><span class="p">(</span><span class="n">Ozone</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Solar.R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Wind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Temp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">aq</span><span class="p">,</span><span class="w"> </span><span class="n">distribution</span><span class="o">=</span><span class="s2">"gaussian"</span><span class="p">,</span><span class="w"> </span><span class="n">n.trees</span><span class="o">=</span><span class="m">5000</span><span class="p">)</span><span class="w">
</span><span class="n">visreg</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="s2">"Temp"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Ozone"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="img/blackbox-gbm_good-1.png" alt="plot of chunk gbm_good" /></p>

<p>This is a nice illustration of how visualizing a “black box” method using <code class="highlighter-rouge">visreg</code> can provide insight into setting some of the tuning parameters of these methods.</p>

      </div>
    </div>

    <footer id="site-footer">

  <div>

    by <a href="http://myweb.uiowa.edu/pbreheny">Patrick Breheny</a>
    <div id="last-updated">
      Last updated: 14 Aug 2020
      <a href="https://github.com/pbreheny/visreg">
        <span class="icon  icon--github">
          <svg viewBox="0 0 16 16">
            <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
          </svg>
        </span>
      </a>
    </div>
  </div>
  
</footer>


  </body>

</html>
